!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs"),require("util"),require("@angular/cdk/coercion"),require("rxjs/operators"),require("@angular/core"),require("@angular/common"),require("ngx-mat-select-search"),require("@angular/material"),require("@angular/forms")):"function"==typeof define&&define.amd?define("ngx-mat-select-table",["exports","rxjs","util","@angular/cdk/coercion","rxjs/operators","@angular/core","@angular/common","ngx-mat-select-search","@angular/material","@angular/forms"],t):t(e["ngx-mat-select-table"]={},e.rxjs,e.util,e.ng.cdk.coercion,e.rxjs.operators,e.ng.core,e.ng.common,e.ngxMatSelectSearch,e.ng.material,e.ng.forms)}(this,function(e,t,d,a,l,n,r,o,i,s){"use strict";function c(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,l=n.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(r=l.next()).done;)o.push(r.value)}catch(i){a={error:i}}finally{try{r&&!r.done&&(n=l["return"])&&n.call(l)}finally{if(a)throw a.error}}return o}function u(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e}var p=(m.prototype.ngOnInit=function(){var a=this;this.multiple=this.multiple||!1,this.matSelect.openedChange.pipe(l.takeUntil(this._onDestroy)).subscribe(function(e){if(!1===a.resetFiltersOnOpen&&a.matOptions.length||a.resetFilters(),a.overallSearchVisibleState=a.overallSearchVisible,!1!==a.resetSortOnOpen&&a.sort.sort({id:"",start:"asc",disableClear:!1}),e){a.overallSearchEnabled&&a.proxyMatSelectSearchConfiguration(a.matSelectSearchConfigurator),a.table._headerRowDefChanged=!0,setTimeout(function(){return[].forEach.call(a.tableRef.nativeElement.querySelectorAll("button.mat-sort-header-button"),function(e){return e.disabled=!0})});var t=a.matSelect.panel.nativeElement,n=t.getBoundingClientRect().height,r=0;a.table._getRenderedRows(a.table._headerRowOutlet).concat(a.table._getRenderedRows(a.table._footerRowOutlet)).forEach(function(e){return r+=e.getBoundingClientRect().height}),isNaN(n)||(t.style.maxHeight=n+r+"px"),!a.matSelectSearchConfigurator.disableScrollToActiveOnOptionsChanged&&!d.isNullOrUndefined(a.matSelect._keyManager)&&0<a.completeRowList.length&&a._onSelectOpen.pipe(l.takeUntil(a._onDestroy),l.debounceTime(1),l.take(1)).subscribe(function(){for(var e=""+a.completeRowList[0].id,t=0;t<a.tableDataSource.length;t++)if(""+a.tableDataSource[t].id==e){a.matSelect._keyManager.setActiveItem(t);try{a.cd.detectChanges()}catch(n){}break}})}else a.close.emit(!e)})},m.prototype.ngAfterViewInit=function(){var n=this;t.merge.apply(void 0,u([this._onOptionsChange,this.sort.sortChange,this.filterControls.valueChanges,this.overallFilterControl.valueChanges])).pipe(l.takeUntil(this._onDestroy),l.debounceTime(100)).subscribe(function(){var e=u(n.dataSource.data);n.addNullRow()&&e.unshift(n.nullRow),n.overallSearchEnabled&&n.overallSearchVisibleState?n.applyOverallFilter(e):n.applyColumnLevelFilters(e),n.sort.active||d.isNullOrUndefined(n.defaultSort)||!n.defaultSort.active||(n.sort.active=n.defaultSort.active,n.sort.direction=n.defaultSort.direction),n.tableDataSource=n.sort.active?n.sortData(e,n.sort.active,n.sort.direction):e;try{n.cd.detectChanges()}catch(t){}n._onSelectOpen.next()}),this.matOptions.changes.subscribe(function(){var t={};n.matOptions.toArray().filter(function(e){return!d.isNullOrUndefined(e)}).forEach(function(e){return t[""+e.value]=e}),n.matSelect.options.reset(n.tableDataSource.filter(function(e){return!d.isNullOrUndefined(t[""+e.id])}).map(function(e){return t[""+e.id]})),n.matSelect.options.notifyOnChanges()}),d.isNullOrUndefined(this.matSelect._keyManager)||this.matSelect._keyManager.change.pipe(l.takeUntil(this._onDestroy)).subscribe(function(e){return n.tableActiveRow=e})},m.prototype.ngOnDestroy=function(){this._onSelectOpen.complete(),this._onDestroy.next(),this._onDestroy.complete()},m.prototype.registerOnChange=function(n){var r=this;this.matSelect.registerOnChange(function(t){if(!0===r.multiple){for(var e=r.completeValueList.length-1;0<=e;e--)r.filteredOutRows[""+r.completeValueList[e]]===undefined&&-1===t.indexOf(r.completeValueList[e])&&r.completeValueList.splice(e,1);t.filter(function(e){return-1===r.completeValueList.indexOf(e)}).forEach(function(e){return r.completeValueList.push(e)}),r.matSelect.value=r.completeValueList,n(r.completeValueList),r.completeRowList.splice(0),r.dataSource.data.filter(function(e){return-1!==r.completeValueList.indexOf(e.id)}).forEach(function(e){return r.completeRowList.push(e)})}else n(t),r.completeRowList.splice(0),r.dataSource.data.filter(function(e){return e.id===t}).forEach(function(e){return r.completeRowList.push(e)})})},m.prototype.registerOnTouched=function(e){this.matSelect.registerOnTouched(e)},m.prototype.setDisabledState=function(e){this.matSelect.setDisabledState(e)},m.prototype.writeValue=function(e){this.updateCompleteRowList(e),this.matSelect.writeValue(e),this.matSelect.value!==e&&(this.matSelect.value=e)},m.prototype.ngOnChanges=function(e){var t=this;if(d.isNullOrUndefined(e.resetFiltersOnOpen)||!1===e.resetFiltersOnOpen.currentValue||this.resetFilters(),d.isNullOrUndefined(e.dataSource)||this.updateCompleteRowList(this.completeRowList.map(function(e){return e.id})),!d.isNullOrUndefined(e.matSelectConfigurator)){var n=e.matSelectConfigurator.currentValue;Object.keys(n).filter(function(e){return!["multiple","panelClass"].includes(e)&&!t.controlValueAccessorKeys.includes(e)}).forEach(function(e){return t.matSelect[e]=n[e]});var r=[];r.push("mat-select-search-table-panel"),d.isNullOrUndefined(n.panelClass)||r.push(n.panelClass),this.overallSearchEnabled&&r.push("mat-select-search-panel"),this.matSelect.panelClass=r}d.isNullOrUndefined(e.matSelectSearchConfigurator)||this.proxyMatSelectSearchConfiguration(e.matSelectSearchConfigurator.currentValue),d.isNullOrUndefined(e.dataSource)||d.isNullOrUndefined(e.dataSource.currentValue)||!d.isArray(e.dataSource.currentValue.data)||(this.tableDataSource=u(e.dataSource.currentValue.data),this.addNullRow()&&this.tableDataSource.unshift(this.nullRow),this.tableColumns=u(["_selection"],e.dataSource.currentValue.columns.map(function(e){return e.key})),this.tableColumnsMap.clear(),e.dataSource.currentValue.columns.forEach(function(e){return t.tableColumnsMap.set(e.key,e)}),this.applyProxyToArray(e.dataSource.currentValue.data,function(){t._onOptionsChange.next()}),this._onOptionsChange.next())},m.prototype.emulateMatOptionClick=function(e){if(!e.composedPath().filter(function(e){return e instanceof HTMLElement}).some(function(e){return"mat-option"===e.tagName.toLowerCase()})&&e.target instanceof HTMLElement){for(var t=e.target;null!=t&&t instanceof HTMLElement&&"tr"!==t.tagName.toLowerCase();)t=t.parentElement;if(null!==t){var n=t.querySelector("mat-option");n&&n.click()}}},m.prototype.filterFormControl=function(e){return this.filterControls.contains(e)||this.filterControls.registerControl(e,new s.FormControl("")),this.filterControls.get(e)},m.prototype.simpleTriggerLabelFn=function(e){var t=this;return e.map(function(n){if(d.isNullOrUndefined(n))return"";if(d.isNullOrUndefined(t.customTriggerLabelTemplate)||"string"!=typeof t.customTriggerLabelTemplate||0===t.customTriggerLabelTemplate.trim().length)return""+n.id;var r=!1,e=t.customTriggerLabelTemplate.replace(/[$]{1}[{]{1}([^}]+)[}]{1}?/g,function(e,t){return!d.isNullOrUndefined(n[t])&&(r=!0)?n[t]:""});return!1===r?""+n.id:e.trim()}).join(", ")},m.prototype.toggleOverallSearch=function(){var e=this;this.overallSearchVisibleState=!this.overallSearchVisibleState,this.resetFilters(),this.overallSearchVisibleState&&setTimeout(function(){return e.matSelectSearch._focus()})},m.prototype.updateCompleteRowList=function(e){var n=this;this.completeRowList.splice(0),this.completeValueList.splice(0),d.isNullOrUndefined(e)||(d.isArray(e)?e:[e]).filter(function(e){return!d.isNullOrUndefined(e)}).forEach(function(t){n.dataSource.data.filter(function(e){return!d.isNullOrUndefined(e)&&!d.isNullOrUndefined(e.id)&&e.id===t}).forEach(function(e){n.completeRowList.push(e),n.completeValueList.push(e.id)})})},m.prototype.proxyMatSelectSearchConfiguration=function(t){var n=this;d.isNullOrUndefined(this.matSelectSearch)||Object.keys(t).filter(function(e){return!["clearSearchInput"].includes(e)&&!n.controlValueAccessorKeys.includes(e)}).forEach(function(e){return n.matSelectSearch[e]=t[e]})},m.prototype.applyColumnLevelFilters=function(e){var n=this;this.filteredOutRows={};var t={};Object.keys(this.filterControls.controls).filter(function(e){return n.tableColumnsMap.has(e)&&!d.isNullOrUndefined(n.tableColumnsMap.get(e).filter)&&!1!==n.tableColumnsMap.get(e).filter.enabled}).filter(function(e){var t=n.filterControls.get(e).value;return!d.isNullOrUndefined(t)&&(d.isArray(t)&&0<t.length||"string"==typeof t&&0<t.trim().length||"number"==typeof t&&0<(""+t).trim().length)}).forEach(function(e){return t[e]={filter:n.tableColumnsMap.get(e).filter,value:n.filterControls.get(e).value}});for(var r=Object.keys(t),a=e.length-1;0<=a;a--)for(var l=0;l<r.length;l++){var o=r[l],i=e[a],s=i[o];if(d.isNullOrUndefined(s))e.splice(a,1).forEach(function(e){return n.filteredOutRows[""+e.id]=e});else{var c=t[o],u=c.filter.comparator;if("function"==typeof c.filter.comparatorFn){if(!c.filter.comparatorFn.call(null,s,c.value,i)){e.splice(a,1).forEach(function(e){return n.filteredOutRows[""+e.id]=e});break}}else if(d.isNullOrUndefined(u)||"equals"===u){if(c.value!==s){e.splice(a,1).forEach(function(e){return n.filteredOutRows[""+e.id]=e});break}}else if("string"==typeof s&&"string"==typeof c.value){var p=(""+s).toLowerCase(),m=c.value.toLowerCase();if(d.isNullOrUndefined(u)||"equalsIgnoreCase"===u){if(m!==p){e.splice(a,1).forEach(function(e){return n.filteredOutRows[""+e.id]=e});break}}else if("contains"===u){if(-1===s.indexOf(c.value)){e.splice(a,1).forEach(function(e){return n.filteredOutRows[""+e.id]=e});break}}else if("containsIgnoreCase"===u){if(-1===p.indexOf(m)){e.splice(a,1).forEach(function(e){return n.filteredOutRows[""+e.id]=e});break}}else if("startsWith"===u){if(!s.startsWith(c.value)){e.splice(a,1).forEach(function(e){return n.filteredOutRows[""+e.id]=e});break}}else if("startsWithIgnoreCase"===u&&!p.startsWith(m)){e.splice(a,1).forEach(function(e){return n.filteredOutRows[""+e.id]=e});break}}}}},m.prototype.applyOverallFilter=function(e){var t=this;if(this.filteredOutRows={},!d.isNullOrUndefined(this.overallFilterControl.value)){var n=this.overallFilterControl.value.toLowerCase();if(0!==n.trim().length)for(var r=e.length-1;0<=r;r--){for(var a=e[r],l=!0,o=this.dataSource.columns.length-1;0<=o;o--){var i=a[this.dataSource.columns[o].key];if(!d.isNullOrUndefined(i)&&-1!==(""+i).toLowerCase().indexOf(n)){l=!1;break}}l&&e.splice(r,1).forEach(function(e){return t.filteredOutRows[""+e.id]=e})}}},m.prototype.applyProxyToArray=function(n,r){["pop","push","reverse","shift","unshift","splice","sort"].forEach(function(t){n[t]=function(){var e=Array.prototype[t].apply(n,arguments);return r.apply(n,arguments),e}})},m.prototype.resetFilters=function(){var t=this;this.overallFilterControl.setValue(""),Object.keys(this.filterControls.controls).forEach(function(e){return t.filterControls.get(e).setValue("")})},m.prototype.sortingDataAccessor=function(e,t){var n=e[t];if(a._isNumberValue(n)){var r=Number(n);return r<9007199254740991?r:n}return n},m.prototype.sortData=function(e,a,t){var l=this;return a&&""!==t?e.sort(function(e,t){var n=l.sortingDataAccessor(e,a),r=l.sortingDataAccessor(t,a);return null===e.id?-1:null===t.id?1:n===r?0:d.isNullOrUndefined(n)&&!d.isNullOrUndefined(r)?-1:!d.isNullOrUndefined(n)&&d.isNullOrUndefined(r)?1:(n instanceof Date&&(n=n.getTime()),r instanceof Date&&(r=r.getTime()),d.isString(n)&&d.isString(r)?n.localeCompare(r)*("asc"===l.sort.direction?1:-1):(n=isNaN(n)?""+n:+n,r=isNaN(r)?""+r:+r,d.isString(n)&&d.isNumber(r)?"asc"===l.sort.direction?1:-1:d.isNumber(n)&&d.isString(r)?-1*("asc"===l.sort.direction?1:-1):(r<n?1:-1)*("asc"===l.sort.direction?1:-1)))}):e},m.prototype.addNullRow=function(){return!this.multiple&&!d.isNullOrUndefined(this.labelForNullValue)},m.decorators=[{type:n.Component,args:[{selector:"ngx-mat-select-table",template:'<mat-form-field>\n  <mat-select #componentSelect\n              [multiple]="multiple"\n              disableRipple>\n\n    <mat-select-trigger>\n      <ng-container *ngIf="!customTriggerLabelFn">{{simpleTriggerLabelFn(completeRowList)}}</ng-container>\n      <ng-container *ngIf="customTriggerLabelFn">{{customTriggerLabelFn(completeRowList)}}</ng-container>\n    </mat-select-trigger>\n\n    <ngx-mat-select-search *ngIf="overallSearchEnabled"\n                           [formControl]="overallFilterControl"\n                           [clearSearchInput]="resetFiltersOnOpen"\n                           [ngClass]="{hidden: overallSearchVisibleState !== true}">\n      <mat-icon *ngIf="matSelectSearchConfigurator?.clearIcon"\n                ngxMatSelectSearchClear\n                color="primary">{{matSelectSearchConfigurator.clearIcon}}</mat-icon>\n    </ngx-mat-select-search>\n    <mat-icon *ngIf="overallSearchEnabled"\n              (click)="toggleOverallSearch()"\n              class="overall-search-toggle"\n              color="primary">{{overallSearchVisibleState ? \'arrow_back\' : \'search\'}}</mat-icon>\n\n    <table #table\n           mat-table\n           matSort\n           [dataSource]="tableDataSource">\n\n      <ng-container *ngFor="let columnKey of tableColumns; let i = index"\n                    [matColumnDef]="columnKey"\n                    [ngSwitch]="columnKey">\n\n        <ng-container *ngSwitchCase="\'_selection\'">\n          <th mat-header-cell *matHeaderCellDef [ngClass]="{selection: true, hidden: !multiple}"></th>\n          <td mat-cell *matCellDef="let row" [ngClass]="{selection: true, hidden: !multiple}">\n            <mat-option [value]="row.id"></mat-option>\n          </td>\n        </ng-container>\n\n        <ng-container *ngSwitchDefault>\n          <th mat-header-cell\n              mat-sort-header\n              [disabled]="!tableColumnsMap.get(columnKey).sortable"\n              *matHeaderCellDef>\n            \x3c!-- Header cell --\x3e\n            <ng-container [ngSwitch]="tableColumnsMap.get(columnKey).filter?.type">\n              <ng-container *ngSwitchCase="\'string\'"\n                            [ngTemplateOutlet]="filterTypeString"\n                            [ngTemplateOutletContext]="{column: tableColumnsMap.get(columnKey)}"></ng-container>\n\n              <div *ngSwitchDefault>{{tableColumnsMap.get(columnKey).name}}</div>\n            </ng-container>\n          </th>\n          <td mat-cell *matCellDef="let row"\n              [colSpan]="addNullRow() && row.id === null && i === 1 ? tableColumns.length : 1"\n              [ngStyle]="{display: addNullRow() && row.id === null && i !== 1 ? \'none\' : \'\'}"\n          >\n            {{addNullRow() && row.id === null && i === 1 ? labelForNullValue : row[columnKey]}}\n          </td>\n        </ng-container>\n\n      </ng-container>\n\n      <tr mat-header-row *matHeaderRowDef="tableColumns; sticky: true"></tr>\n      <tr mat-row *matRowDef="let row; columns: tableColumns; let i = index"\n          (click)="emulateMatOptionClick($event)"\n          [ngClass]="{active: i === tableActiveRow}"></tr>\n    </table>\n\n  </mat-select>\n</mat-form-field>\n\n<ng-template #filterTypeString\n             let-column=\'column\'>\n  <mat-form-field\n    (click)="$event.stopPropagation()"\n    class="filter">\n    <input matInput\n           [formControl]="filterFormControl(column.key)"\n           (keydown)="$event.stopPropagation()"\n           (keyup)="$event.stopPropagation()"\n           (keypress)="$event.stopPropagation()"\n           [placeholder]="column.name"/>\n  </mat-form-field>\n</ng-template>\n',exportAs:"ngx-mat-select-table",changeDetection:n.ChangeDetectionStrategy.OnPush,providers:[{provide:s.NG_VALUE_ACCESSOR,useExisting:n.forwardRef(function(){return m}),multi:!0}],styles:[":host{display:block}:host mat-form-field{width:100%}::ng-deep .mat-select-panel.mat-select-search-table-panel{overflow-x:auto!important}::ng-deep .mat-select-panel.mat-select-search-table-panel .overall-search-toggle{z-index:102;position:absolute;left:13px;top:17px;cursor:pointer}::ng-deep .mat-select-panel.mat-select-search-table-panel ngx-mat-select-search{position:absolute;z-index:101}::ng-deep .mat-select-panel.mat-select-search-table-panel ngx-mat-select-search.hidden{display:none}::ng-deep .mat-select-panel.mat-select-search-table-panel ngx-mat-select-search .mat-select-search-inner{height:56px}::ng-deep .mat-select-panel.mat-select-search-table-panel ngx-mat-select-search .mat-select-search-inner .mat-select-search-input{margin-left:26px;width:calc(100% - 26px)}::ng-deep .mat-select-panel.mat-select-search-table-panel table{width:100%}::ng-deep .mat-select-panel.mat-select-search-table-panel table tr{cursor:pointer;height:48px;max-height:48px}::ng-deep .mat-select-panel.mat-select-search-table-panel table tr mat-option{height:48px;max-height:48px}::ng-deep .mat-select-panel.mat-select-search-table-panel table tr.active{background:rgba(0,0,0,.04)}::ng-deep .mat-select-panel.mat-select-search-table-panel table tr td{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;border-bottom:0!important;box-shadow:inset 0 -1px 0 0 rgba(0,0,0,.12)}::ng-deep .mat-select-panel.mat-select-search-table-panel table tr th ::ng-deep .mat-sort-header-container{height:55px}::ng-deep .mat-select-panel.mat-select-search-table-panel table tr th ::ng-deep .mat-sort-header-container mat-form-field .mat-form-field-infix{width:initial}::ng-deep .mat-select-panel.mat-select-search-table-panel table tr th[aria-sort] ::ng-deep .mat-sort-header-arrow{opacity:1!important}::ng-deep .mat-select-panel.mat-select-search-table-panel table tr td mat-option,::ng-deep .mat-select-panel.mat-select-search-table-panel table tr th mat-option{background:0 0!important}::ng-deep .mat-select-panel.mat-select-search-table-panel table tr td.selection,::ng-deep .mat-select-panel.mat-select-search-table-panel table tr th.selection{width:56px;padding:0;margin:0}::ng-deep .mat-select-panel.mat-select-search-table-panel table tr td.selection.hidden mat-option,::ng-deep .mat-select-panel.mat-select-search-table-panel table tr th.selection.hidden mat-option{visibility:hidden}"]}]}],m.ctorParameters=function(){return[{type:n.ChangeDetectorRef}]},m.propDecorators={dataSource:[{type:n.Input}],multiple:[{type:n.Input}],overallSearchEnabled:[{type:n.Input}],overallSearchVisible:[{type:n.Input}],resetSortOnOpen:[{type:n.Input}],resetFiltersOnOpen:[{type:n.Input}],customTriggerLabelFn:[{type:n.Input}],customTriggerLabelTemplate:[{type:n.Input}],labelForNullValue:[{type:n.Input}],matSelectConfigurator:[{type:n.Input}],matSelectSearchConfigurator:[{type:n.Input}],defaultSort:[{type:n.Input}],close:[{type:n.Output}],matSelect:[{type:n.ViewChild,args:["componentSelect"]}],matSelectSearch:[{type:n.ViewChild,args:[o.MatSelectSearchComponent]}],sort:[{type:n.ViewChild,args:[i.MatSort]}],table:[{type:n.ViewChild,args:[i.MatTable]}],tableRef:[{type:n.ViewChild,args:["table",{read:n.ElementRef}]}],matOptions:[{type:n.ViewChildren,args:[i.MatOption]}]},m);function m(e){this.cd=e,this.nullRow={id:null},this.close=new n.EventEmitter,this.completeRowList=[],this.completeValueList=[],this.controlValueAccessorKeys=["formControl","formControlName","formGroup","formGroupName","formArray","formArrayName"],this._onDestroy=new t.Subject,this._onSelectOpen=new t.Subject,this._onOptionsChange=new t.Subject,this.tableColumnsMap=new Map,this.filterControls=new s.FormGroup({}),this.overallFilterControl=new s.FormControl("")}var f=(h.decorators=[{type:n.NgModule,args:[{declarations:[p],imports:[r.CommonModule,s.FormsModule,s.ReactiveFormsModule,i.MatSelectModule,i.MatSortModule,i.MatOptionModule,i.MatCommonModule,i.MatTableModule,i.MatInputModule,i.MatIconModule,o.NgxMatSelectSearchModule],providers:[],bootstrap:[p],exports:[p]}]}],h);function h(){}e.MatSelectTableComponent=p,e.NgxMatSelectTableModule=f,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-mat-select-table.umd.min.js.map