!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs"),require("util"),require("@angular/cdk/coercion"),require("rxjs/operators"),require("@angular/core"),require("@angular/common"),require("ngx-mat-select-search"),require("@angular/material"),require("@angular/forms")):"function"==typeof define&&define.amd?define("ngx-mat-select-table",["exports","rxjs","util","@angular/cdk/coercion","rxjs/operators","@angular/core","@angular/common","ngx-mat-select-search","@angular/material","@angular/forms"],t):t(e["ngx-mat-select-table"]={},e.rxjs,e.util,e.ng.cdk.coercion,e.rxjs.operators,e.ng.core,e.ng.common,e.ngxMatSelectSearch,e.ng.material,e.ng.forms)}(this,function(e,t,m,a,n,r,l,o,i,s){"use strict";function c(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,a,l=r.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(n=l.next()).done;)o.push(n.value)}catch(i){a={error:i}}finally{try{n&&!n.done&&(r=l["return"])&&r.call(l)}finally{if(a)throw a.error}}return o}function u(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e}var p=(f.prototype.ngOnInit=function(){var a=this;this.multiple=this.multiple||!1,this.matSelect.openedChange.pipe(n.takeUntil(this._onDestroy)).subscribe(function(e){if(!1===a.resetFiltersOnOpen&&a.matOptions.length||a.resetFilters(),e){a.overallSearchVisibleState=a.overallSearchVisible,!1!==a.resetSortOnOpen&&a.sort.sort({id:"",start:"asc",disableClear:!1}),a.overallSearchEnabled&&a.proxyMatSelectSearchConfiguration(a.matSelectSearchConfigurator),a.table._headerRowDefChanged=!0,setTimeout(function(){return[].forEach.call(a.tableRef.nativeElement.querySelectorAll("button.mat-sort-header-button"),function(e){return e.disabled=!0})});var t=a.matSelect.panel.nativeElement,r=t.getBoundingClientRect().height,n=0;a.table._getRenderedRows(a.table._headerRowOutlet).concat(a.table._getRenderedRows(a.table._footerRowOutlet)).forEach(function(e){return n+=e.getBoundingClientRect().height}),isNaN(r)||(t.style.maxHeight=r+n+"px")}})},f.prototype.ngAfterViewInit=function(){var r=this;t.merge.apply(void 0,u([this.sort.sortChange,this.filterControls.valueChanges,this.overallFilterControl.valueChanges])).pipe(n.takeUntil(this._onDestroy),n.debounceTime(100)).subscribe(function(){var e=u(r.dataSource.data);r.overallSearchEnabled&&r.overallSearchVisibleState?r.applyOverallFilter(e):r.applyColumnLevelFilters(e),r.tableDataSource=r.sort.direction?r.sortData(e,r.sort):e,r.cd.detectChanges()}),this.matOptions.changes.subscribe(function(){var t={};r.matOptions.toArray().filter(function(e){return!m.isNullOrUndefined(e)}).forEach(function(e){return t[""+e.value]=e}),r.matSelect.options.reset(r.tableDataSource.filter(function(e){return!m.isNullOrUndefined(t[""+e.id])}).map(function(e){return t[""+e.id]})),r.matSelect.options.notifyOnChanges()}),m.isNullOrUndefined(this.matSelect._keyManager)||this.matSelect._keyManager.change.pipe(n.takeUntil(this._onDestroy)).subscribe(function(e){return r.tableActiveRow=e})},f.prototype.ngOnDestroy=function(){this._onDestroy.next(),this._onDestroy.complete()},f.prototype.registerOnChange=function(r){var n=this;this.matSelect.registerOnChange(function(t){if(!0===n.multiple){for(var e=n.completeValueList.length-1;0<=e;e--)n.filteredOutRows[""+n.completeValueList[e]]===undefined&&-1===t.indexOf(n.completeValueList[e])&&n.completeValueList.splice(e,1);t.filter(function(e){return-1===n.completeValueList.indexOf(e)}).forEach(function(e){return n.completeValueList.push(e)}),n.matSelect.value=n.completeValueList,r(n.completeValueList),n.completeRowList.splice(0),n.dataSource.data.filter(function(e){return-1!==n.completeValueList.indexOf(e.id)}).forEach(function(e){return n.completeRowList.push(e)})}else r(t),n.completeRowList.splice(0),n.dataSource.data.filter(function(e){return e.id===t}).forEach(function(e){return n.completeRowList.push(e)})})},f.prototype.registerOnTouched=function(e){this.matSelect.registerOnTouched(e)},f.prototype.setDisabledState=function(e){this.matSelect.setDisabledState(e)},f.prototype.writeValue=function(e){this.matSelect.writeValue(e),this.matSelect.value!==e&&(this.matSelect.value=e)},f.prototype.ngOnChanges=function(e){var t=this;if(m.isNullOrUndefined(e.resetFiltersOnOpen)||!1===e.resetFiltersOnOpen.currentValue||this.resetFilters(),!m.isNullOrUndefined(e.matSelectConfigurator)){var r=e.matSelectConfigurator.currentValue;Object.keys(r).filter(function(e){return!["multiple","panelClass"].includes(e)&&!t.controlValueAccessorKeys.includes(e)}).forEach(function(e){return t.matSelect[e]=r[e]});var n=[];m.isNullOrUndefined(r.panelClass)||n.push(r.panelClass),this.overallSearchEnabled&&n.push("mat-select-search-panel"),this.matSelect.panelClass=n}m.isNullOrUndefined(e.matSelectSearchConfigurator)||this.proxyMatSelectSearchConfiguration(e.matSelectSearchConfigurator.currentValue),m.isNullOrUndefined(e.dataSource)||m.isNullOrUndefined(e.dataSource.currentValue)||!m.isArray(e.dataSource.currentValue.data)||(this.tableDataSource=u(e.dataSource.currentValue.data),this.tableColumns=u(["_selection"],e.dataSource.currentValue.columns.map(function(e){return e.key})),this.tableColumnsMap.clear(),e.dataSource.currentValue.columns.forEach(function(e){return t.tableColumnsMap.set(e.key,e)}),this.applyProxyToArray(e.dataSource.currentValue.data,function(){t._onOptionsChange.next()}),this._onOptionsChange.next())},f.prototype.emulateMatOptionClick=function(e){if(!e.composedPath().filter(function(e){return e instanceof HTMLElement}).some(function(e){return"mat-option"===e.tagName.toLowerCase()})&&e.target instanceof HTMLElement){for(var t=e.target;null!=t&&t instanceof HTMLElement&&"tr"!==t.tagName.toLowerCase();)t=t.parentElement;if(null!==t){var r=t.querySelector("mat-option");r&&r.click()}}},f.prototype.filterFormControl=function(e){return this.filterControls.contains(e)||this.filterControls.registerControl(e,new s.FormControl("")),this.filterControls.get(e)},f.prototype.simpleTriggerLabelFn=function(e){var t=this;return e.map(function(r){if(m.isNullOrUndefined(r))return"";if(m.isNullOrUndefined(t.customTriggerLabelTemplate)||"string"!=typeof t.customTriggerLabelTemplate||0===t.customTriggerLabelTemplate.trim().length)return""+r.id;var n=!1,e=t.customTriggerLabelTemplate.replace(/[$]{1}[{]{1}([^}]+)[}]{1}?/g,function(e,t){return!m.isNullOrUndefined(r[t])&&(n=!0)?r[t]:""});return!1===n?""+r.id:e.trim()}).join(", ")},f.prototype.toggleOverallSearch=function(){var e=this;this.overallSearchVisibleState=!this.overallSearchVisibleState,this.resetFilters(),this.overallSearchVisibleState&&setTimeout(function(){return e.matSelectSearch._focus()})},f.prototype.proxyMatSelectSearchConfiguration=function(t){var r=this;m.isNullOrUndefined(this.matSelectSearch)||Object.keys(t).filter(function(e){return!["clearSearchInput"].includes(e)&&!r.controlValueAccessorKeys.includes(e)}).forEach(function(e){return r.matSelectSearch[e]=t[e]})},f.prototype.applyColumnLevelFilters=function(e){var r=this;this.filteredOutRows={};var t={};Object.keys(this.filterControls.controls).filter(function(e){return r.tableColumnsMap.has(e)&&!m.isNullOrUndefined(r.tableColumnsMap.get(e).filter)&&!1!==r.tableColumnsMap.get(e).filter.enabled}).filter(function(e){var t=r.filterControls.get(e).value;return!m.isNullOrUndefined(t)&&(m.isArray(t)&&0<t.length||"string"==typeof t&&0<t.trim().length||"number"==typeof t&&0<(""+t).trim().length)}).forEach(function(e){return t[e]={filter:r.tableColumnsMap.get(e).filter,value:r.filterControls.get(e).value}});for(var n=Object.keys(t),a=e.length-1;0<=a;a--)for(var l=0;l<n.length;l++){var o=n[l],i=e[a],s=i[o];if(!m.isNullOrUndefined(s)){var c=t[o],u=c.filter.comparator;if("function"==typeof c.filter.comparatorFn){if(!c.filter.comparatorFn.call(null,s,c.value,i)){e.splice(a,1).forEach(function(e){return r.filteredOutRows[""+e.id]=e});break}}else if(m.isNullOrUndefined(u)||"equals"===u){if(c.value!==s){e.splice(a,1).forEach(function(e){return r.filteredOutRows[""+e.id]=e});break}}else if("string"==typeof s&&"string"==typeof c.value){var p=(""+s).toLowerCase(),f=c.value.toLowerCase();if(m.isNullOrUndefined(u)||"equalsIgnoreCase"===u){if(f!==p){e.splice(a,1).forEach(function(e){return r.filteredOutRows[""+e.id]=e});break}}else if("contains"===u){if(-1===s.indexOf(c.value)){e.splice(a,1).forEach(function(e){return r.filteredOutRows[""+e.id]=e});break}}else if("containsIgnoreCase"===u){if(-1===p.indexOf(f)){e.splice(a,1).forEach(function(e){return r.filteredOutRows[""+e.id]=e});break}}else if("startsWith"===u){if(!s.startsWith(c.value)){e.splice(a,1).forEach(function(e){return r.filteredOutRows[""+e.id]=e});break}}else if("startsWithIgnoreCase"===u&&!p.startsWith(f)){e.splice(a,1).forEach(function(e){return r.filteredOutRows[""+e.id]=e});break}}}}},f.prototype.applyOverallFilter=function(e){var t=this;if(this.filteredOutRows={},!m.isNullOrUndefined(this.overallFilterControl.value)){var r=this.overallFilterControl.value.toLowerCase();if(0!==r.trim().length)for(var n=e.length-1;0<=n;n--){for(var a=e[n],l=!0,o=this.dataSource.columns.length-1;0<=o;o--){var i=a[this.dataSource.columns[o].key];if(!m.isNullOrUndefined(i)&&-1!==(""+i).toLowerCase().indexOf(r)){l=!1;break}}l&&e.splice(n,1).forEach(function(e){return t.filteredOutRows[""+e.id]=e})}}},f.prototype.applyProxyToArray=function(r,n){["pop","push","reverse","shift","unshift","splice","sort"].forEach(function(t){r[t]=function(){var e=Array.prototype[t].apply(r,arguments);return n.apply(r,arguments),e}})},f.prototype.resetFilters=function(){var t=this;this.overallFilterControl.setValue(""),Object.keys(this.filterControls.controls).forEach(function(e){return t.filterControls.get(e).setValue("")})},f.prototype.sortingDataAccessor=function(e,t){var r=e[t];if(a._isNumberValue(r)){var n=Number(r);return n<9007199254740991?n:r}return r},f.prototype.sortData=function(e,t){var l=this,o=t.active,i=t.direction;return o&&""!==i?e.sort(function(e,t){var r=l.sortingDataAccessor(e,o),n=l.sortingDataAccessor(t,o),a=0;return null!=r&&null!=n?n<r?a=1:r<n&&(a=-1):null!=r?a=1:null!=n&&(a=-1),a*("asc"===i?1:-1)}):e},f.decorators=[{type:r.Component,args:[{selector:"ngx-mat-select-table",template:'<mat-form-field>\r\n  <mat-select #componentSelect\r\n              [multiple]="multiple"\r\n              disableRipple>\r\n\r\n    <mat-select-trigger>\r\n      <ng-container *ngIf="!customTriggerLabelFn">{{simpleTriggerLabelFn(completeRowList)}}</ng-container>\r\n      <ng-container *ngIf="customTriggerLabelFn">{{customTriggerLabelFn(completeRowList)}}</ng-container>\r\n    </mat-select-trigger>\r\n\r\n    <ngx-mat-select-search *ngIf="overallSearchEnabled"\r\n                           [formControl]="overallFilterControl"\r\n                           [clearSearchInput]="resetFiltersOnOpen"\r\n                           [ngClass]="{hidden: overallSearchVisibleState !== true}">\r\n      <mat-icon *ngIf="matSelectSearchConfigurator?.clearIcon"\r\n                ngxMatSelectSearchClear\r\n                color="primary">{{matSelectSearchConfigurator.clearIcon}}</mat-icon>\r\n    </ngx-mat-select-search>\r\n    <mat-icon *ngIf="overallSearchEnabled"\r\n              (click)="toggleOverallSearch()"\r\n              class="overall-search-toggle"\r\n              color="primary">{{overallSearchVisibleState ? \'arrow_back\' : \'search\'}}</mat-icon>\r\n\r\n    <table #table\r\n           mat-table\r\n           matSort\r\n           [dataSource]="tableDataSource">\r\n\r\n      <ng-container *ngFor="let columnKey of tableColumns"\r\n                    [matColumnDef]="columnKey"\r\n                    [ngSwitch]="columnKey">\r\n\r\n        <ng-container *ngSwitchCase="\'_selection\'">\r\n          <th mat-header-cell *matHeaderCellDef [ngClass]="{selection: true, hidden: !multiple}"></th>\r\n          <td mat-cell *matCellDef="let row" [ngClass]="{selection: true, hidden: !multiple}">\r\n            <mat-option [value]="row.id"></mat-option>\r\n          </td>\r\n        </ng-container>\r\n\r\n        <ng-container *ngSwitchDefault>\r\n          <th mat-header-cell\r\n              mat-sort-header\r\n              [disabled]="!tableColumnsMap.get(columnKey).sortable"\r\n              *matHeaderCellDef>\r\n            \x3c!-- Header cell --\x3e\r\n            <ng-container [ngSwitch]="tableColumnsMap.get(columnKey).filter?.type">\r\n              <ng-container *ngSwitchCase="\'string\'"\r\n                            [ngTemplateOutlet]="filterTypeString"\r\n                            [ngTemplateOutletContext]="{column: tableColumnsMap.get(columnKey)}"></ng-container>\r\n\r\n              <div *ngSwitchDefault>{{tableColumnsMap.get(columnKey).name}}</div>\r\n            </ng-container>\r\n          </th>\r\n          <td mat-cell *matCellDef="let row">{{row[columnKey]}}</td>\r\n        </ng-container>\r\n\r\n      </ng-container>\r\n\r\n      <tr mat-header-row *matHeaderRowDef="tableColumns; sticky: true"></tr>\r\n      <tr mat-row *matRowDef="let row; columns: tableColumns; let i = index"\r\n          (click)="emulateMatOptionClick($event)"\r\n          [ngClass]="{active: i === tableActiveRow}"></tr>\r\n    </table>\r\n\r\n  </mat-select>\r\n</mat-form-field>\r\n\r\n<ng-template #filterTypeString\r\n             let-column=\'column\'>\r\n  <mat-form-field\r\n    (click)="$event.stopPropagation()"\r\n    class="filter">\r\n    <input matInput\r\n           [formControl]="filterFormControl(column.key)"\r\n           (keydown)="$event.stopPropagation()"\r\n           (keyup)="$event.stopPropagation()"\r\n           (keypress)="$event.stopPropagation()"\r\n           [placeholder]="column.name"/>\r\n  </mat-form-field>\r\n</ng-template>\r\n',exportAs:"ngx-mat-select-table",changeDetection:r.ChangeDetectionStrategy.OnPush,providers:[{provide:s.NG_VALUE_ACCESSOR,useExisting:r.forwardRef(function(){return f}),multi:!0}],styles:[":host{display:block}:host mat-form-field{width:100%}::ng-deep .mat-select-panel{overflow-x:auto!important}::ng-deep .mat-select-panel .overall-search-toggle{z-index:102;position:absolute;left:13px;top:17px;cursor:pointer}::ng-deep .mat-select-panel ngx-mat-select-search{position:absolute;z-index:101}::ng-deep .mat-select-panel ngx-mat-select-search.hidden{display:none}::ng-deep .mat-select-panel ngx-mat-select-search .mat-select-search-inner{height:56px}::ng-deep .mat-select-panel ngx-mat-select-search .mat-select-search-inner .mat-select-search-input{margin-left:26px}::ng-deep .mat-select-panel table{width:100%}::ng-deep .mat-select-panel table tr{cursor:pointer}::ng-deep .mat-select-panel table tr.active{background:rgba(0,0,0,.04)}::ng-deep .mat-select-panel table tr td{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}::ng-deep .mat-select-panel table tr th ::ng-deep .mat-sort-header-container{height:55px}::ng-deep .mat-select-panel table tr th ::ng-deep .mat-sort-header-container mat-form-field .mat-form-field-infix{width:initial}::ng-deep .mat-select-panel table tr td mat-option,::ng-deep .mat-select-panel table tr th mat-option{background:0 0!important}::ng-deep .mat-select-panel table tr td.selection,::ng-deep .mat-select-panel table tr th.selection{width:56px;padding:0;margin:0}::ng-deep .mat-select-panel table tr td.selection.hidden mat-option,::ng-deep .mat-select-panel table tr th.selection.hidden mat-option{visibility:hidden}"]}]}],f.ctorParameters=function(){return[{type:r.ChangeDetectorRef}]},f.propDecorators={dataSource:[{type:r.Input}],multiple:[{type:r.Input}],overallSearchEnabled:[{type:r.Input}],overallSearchVisible:[{type:r.Input}],resetSortOnOpen:[{type:r.Input}],resetFiltersOnOpen:[{type:r.Input}],customTriggerLabelFn:[{type:r.Input}],customTriggerLabelTemplate:[{type:r.Input}],matSelectConfigurator:[{type:r.Input}],matSelectSearchConfigurator:[{type:r.Input}],matSelect:[{type:r.ViewChild,args:["componentSelect"]}],matSelectSearch:[{type:r.ViewChild,args:[o.MatSelectSearchComponent]}],sort:[{type:r.ViewChild,args:[i.MatSort]}],table:[{type:r.ViewChild,args:[i.MatTable]}],tableRef:[{type:r.ViewChild,args:["table",{read:r.ElementRef}]}],matOptions:[{type:r.ViewChildren,args:[i.MatOption]}]},f);function f(e){this.cd=e,this.completeRowList=[],this.completeValueList=[],this.controlValueAccessorKeys=["formControl","formControlName","formGroup","formGroupName","formArray","formArrayName"],this._onDestroy=new t.Subject,this._onOptionsChange=new t.Subject,this.tableColumnsMap=new Map,this.filterControls=new s.FormGroup({}),this.overallFilterControl=new s.FormControl("")}var d=(h.decorators=[{type:r.NgModule,args:[{declarations:[p],imports:[l.CommonModule,s.FormsModule,s.ReactiveFormsModule,i.MatSelectModule,i.MatSortModule,i.MatOptionModule,i.MatCommonModule,i.MatTableModule,i.MatInputModule,i.MatIconModule,o.NgxMatSelectSearchModule],providers:[],bootstrap:[p],exports:[p]}]}],h);function h(){}e.MatSelectTableComponent=p,e.NgxMatSelectTableModule=d,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-mat-select-table.umd.min.js.map